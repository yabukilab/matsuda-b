<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>津田沼校舎食堂 モバイルオーダーシステム</title>
    <!-- CSSは省略（前のままでOK） -->
</head>
<body>
    <!-- 中略: HTML構造は元のまま -->

    <div id="selectedMenuInfo" style="display: none; text-align: center; margin: 20px 0; padding: 15px; background: #e8f5e8; border-radius: 8px;">
        <strong>選択中: </strong><span id="selectedMenuName"></span> - <span id="selectedMenuPrice"></span>
    </div>

    <!-- JavaScriptの末尾に以下を追加・修正 -->
    <script>
        let currentUser = null;
        let selectedMenus = [];
        let orderHistory = [];
        let orderCounter = 1;

        let menuDatabase = [
            { id: 1, name: '工大ランチ', price: 450 },
            { id: 2, name: 'カレー', price: 350 },
            { id: 3, name: 'サンドイッチ', price: 280 },
            { id: 4, name: 'そば', price: 380 }
        ];

        function renderMenuGrid() {
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = menuDatabase.map(menu => `
                <div class="menu-item" onclick="toggleMenuSelection('${menu.name}', ${menu.price}, this)">
                    <div class="menu-name">${menu.name}</div>
                    <div class="menu-price">¥${menu.price}</div>
                </div>
            `).join('');
        }

        function toggleMenuSelection(name, price, element) {
            const index = selectedMenus.findIndex(menu => menu.name === name);
            if (index > -1) {
                selectedMenus.splice(index, 1);
                element.classList.remove('selected');
            } else {
                selectedMenus.push({ name, price });
                element.classList.add('selected');
            }
            updateSelectedMenuInfo();
        }

        function updateSelectedMenuInfo() {
            const infoDiv = document.getElementById('selectedMenuInfo');
            const nameSpan = document.getElementById('selectedMenuName');
            const priceSpan = document.getElementById('selectedMenuPrice');

            if (selectedMenus.length > 0) {
                const names = selectedMenus.map(m => m.name).join('、');
                const total = selectedMenus.reduce((sum, m) => sum + m.price, 0);
                nameSpan.textContent = names;
                priceSpan.textContent = `合計 ¥${total}`;
                infoDiv.style.display = 'block';
                document.getElementById('orderBtn').disabled = false;
            } else {
                infoDiv.style.display = 'none';
                document.getElementById('orderBtn').disabled = true;
            }
        }

        function confirmOrder() {
            if (selectedMenus.length === 0) {
                showError('purchaseError', 'メニューを選択してください');
                return;
            }

            const callNumber = `A${String(orderCounter).padStart(3, '0')}`;
            const totalPrice = selectedMenus.reduce((sum, m) => sum + m.price, 0);
            const menuNames = selectedMenus.map(m => m.name).join('、');

            const order = {
                id: orderCounter,
                callNumber,
                menu: menuNames,
                price: totalPrice,
                user: currentUser.name,
                time: new Date().toLocaleTimeString('ja-JP'),
                status: '調理中'
            };

            orderHistory.unshift(order);
            orderCounter++;

            document.getElementById('callNumber').textContent = callNumber;
            selectedMenus = [];
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('selected'));
            updateSelectedMenuInfo();
            showScreen('orderComplete');
        }
    </script>
</body>
</html>
